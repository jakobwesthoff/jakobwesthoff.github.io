import{d as E,A as G,q as x,y as _}from"./hooks.module.DiMXjq1x.js";import{u as c}from"./jsxRuntime.module.fOORsCCE.js";import"./preact.module.B5PsXcXZ.js";function j({spriteSrc:$,spriteWidth:r,spriteHeight:m,gridSize:h=11,minValue:l=-15,maxValue:F=15,step:f=3,size:y,className:N="",debug:O=!1,idleTimeout:p=1200,onCenter:s,onLooking:T}){const[u,a]=E({x:0,y:0}),[v,k]=E({col:0,row:0}),[R,X]=E({x:0,y:0}),C=G(null),i=G(null),z=x((o,n)=>{const e=Math.round((o-l)/f),t=Math.round((n-l)/f),d=Math.max(0,Math.min(h-1,e)),P=Math.max(0,Math.min(h-1,t)),S=r/h,M=-(d*S),L=-(P*S);return{x:M,y:L,col:d,row:P}},[]),w=x((o,n,e)=>Math.max(n,Math.min(e,o)),[]),b=x(o=>{const n=l+(o+1)*(F-l)/2,e=Math.round(n/f)*f;return w(e,l,F)},[w]),A=x((o,n,e=!0)=>{X({x:o,y:n});const t=z(o,n);a({x:t.x,y:t.y}),k({col:t.col,row:t.row}),e&&(o===0&&n===0?s?.():T?.())},[a,k,a,X,s,T]),Y=x(()=>{s?.()},[s]),I=x((o,n)=>{if(!C.current)return;const e=C.current.getBoundingClientRect(),t=e.left+e.width/2,d=e.top+e.height/2,P=(o-t)/(e.width/2),S=(d-n)/(e.height/2),M=w(P,-1,1),L=w(S,-1,1),q=b(M),D=b(L);A(q,D),i.current!==null&&clearTimeout(i.current),i.current=setTimeout(()=>{Y()},p)},[A,b,w,i,C]);_(()=>{A(0,0,!1);const o=t=>{I(t.clientX,t.clientY)},n=t=>{if(t.touches&&t.touches.length>0){const d=t.touches[0];I(d.clientX,d.clientY)}},e=()=>{i.current!==null&&clearTimeout(i.current),i.current=setTimeout(()=>{Y()},p)};return window.addEventListener("mousemove",o),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("touchend",e),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",e),i.current!==null&&clearTimeout(i.current)}},[p]);const B=r/h,g=y/B;return c("div",{className:"flex flex-col items-center gap-3",children:[c("div",{ref:C,className:`face-looker ${N}`,style:{width:`${y}px`,height:`${y}px`,backgroundImage:`url(${$})`,backgroundSize:`${r*g}px ${m*g}px`,backgroundPosition:`${u.x*g}px ${u.y*g}px`,backgroundRepeat:"no-repeat"},role:"img","aria-label":"Interactive face that follows your gaze"}),O&&c("div",{className:"rounded bg-black/80 px-4 py-3 font-mono text-sm text-white",children:[c("div",{children:["Pupil X: ",R.x," | Pupil Y: ",R.y]}),c("div",{children:["Grid Position: (",v.col,", ",v.row,")"]}),c("div",{children:["BG Position: (",u.x.toFixed(1),"px, ",u.y.toFixed(1),"px)"]}),c("div",{children:["Cell Size: ",B.toFixed(1),"px | Scale: ",g.toFixed(2),"x"]}),c("div",{children:["Sprite Size: ",r,"x",m,"px"]})]})]})}function Q({src:$,width:r,height:m,alt:h,gazeSpriteSrc:l,gazeSpriteWidth:F,gazeSpriteHeight:f}){const[p,s]=E(!1),[T,u]=E(!1);return _(()=>{const a=setTimeout(()=>{s(!0),setTimeout(()=>s(!1),600)},300);return()=>clearTimeout(a)},[]),_(()=>{let a;const v=()=>{const k=Math.random()*6e4+6e4;a=setTimeout(()=>{s(!0),setTimeout(()=>s(!1),600),v()},k)};return v(),()=>clearTimeout(a)},[]),c("div",{className:`relative mx-auto mb-6 overflow-hidden rounded-full shadow-2xl ring-4 ring-white/90 ${p?"animate-shake":""}`,style:{width:`${r}px`,height:`${m}px`},children:[c("img",{src:$,width:r,height:m,alt:h,loading:"eager",className:"h-full w-full rounded-full object-cover",style:"filter: contrast(1.1) brightness(1.05);"}),c("div",{className:"mask-radial-fade absolute transition-opacity ease-in-out",style:{transitionDuration:"350ms",width:`${r*.54}px`,height:`${m*.54}px`,left:"50%",top:"50%",filter:"contrast(1.1) brightness(1.05)",transform:"translate(calc(-50% + 4px), calc(-50% + -28px))",opacity:T?1:0},children:c(j,{spriteSrc:l,spriteWidth:F,spriteHeight:f,size:r*.54,className:"",debug:!1,onCenter:()=>u(!1),onLooking:()=>u(!0)})})]})}export{Q as default};
